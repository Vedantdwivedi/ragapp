services:
  message_queue:
    image: ragapp/ragapp
    build: .
    command: ["python", "src/message_queue/main.py"]
    ports:
      - "8100:8100"
    environment:
      - MESSAGE_QUEUE_HOST=message_queue
      - MESSAGE_QUEUE_PORT=8100
    networks:
      - ragapp-network

  control_plane:
    image: ragapp/ragapp
    build: .
    command: ["python", "src/control_plane/main.py"]
    ports:
      - "8000:8000"
    environment:
      - HOST=control_plane
      - PORT=8000
      - MESSAGE_QUEUE_URL=http://message_queue:8100
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - MODEL=gpt-3.5-turbo
      - ORCHESTRATOR_TYPE=agent
    networks:
      - ragapp-network
    depends_on:
      - message_queue

  travel_agent:
    image: ragapp/ragapp
    build: .
    configs:
      - source: travel_agent_tools_config
        target: /app/config/tools.yaml
    command: ["python", "src/app/main.py"]
    environment:
      - AGENT=true
      - PORT=8000 # Specify the port explicitly to register the agent with other services
      - CONTROL_PLANE_URL=http://control_plane:8000
      - MESSAGE_QUEUE_URL=http://message_queue:8100
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ENVIRONMENT=dev
      - DESCRIPTION=I can use DuckDuckGo search to find information about a country.
      - SYSTEM_PROMPT=You're a helpful travel agent, your task is use DuckDuckGo search to find information about a country. You just need to return the information you find.
    depends_on:
      - control_plane
      - message_queue
    networks:
      - ragapp-network

  research_agent:
    image: ragapp/ragapp
    build: .
    configs:
      - source: research_agent_tools_config
        target: /app/config/tools.yaml
    command: ["python", "src/app/main.py"]
    environment:
      - AGENT=true
      - PORT=8000 # Specify the port explicitly to register the agent with other services
      - CONTROL_PLANE_URL=http://control_plane:8000
      - MESSAGE_QUEUE_URL=http://message_queue:8100
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ENVIRONMENT=dev
      - DESCRIPTION=I can help you make a plan for your trip and give you some tips on where to go.
      - SYSTEM_PROMPT=You are a smart assistant, you can answer using no additional tools. Use the provided information to help the user plan their trip.
    depends_on:
      - control_plane
      - message_queue
    networks:
      - ragapp-network

configs:
  travel_agent_tools_config:
    content: |
      llamahub: {}
      local:
        duckduckgo: {}
  research_agent_tools_config:
    content: |
      llamahub: {}
      local: {}

networks:
  ragapp-network:
    driver: bridge